{% extends 'shop/base.html' %}

{% block content %}
<div class="filters">
    <h3>Фильтры</h3>
    <form method="get">
        <label>Пол:
            <select name="gender">
                <option value="">Любой</option>
                <option value="M" {% if selected_gender == 'M' %}selected{% endif %}>Мужская</option>
                <option value="F" {% if selected_gender == 'F' %}selected{% endif %}>Женская</option>
                <option value="U" {% if selected_gender == 'U' %}selected{% endif %}>Унисекс</option>
            </select>
        </label>

        <label>Сезон:
            <select name="season">
                <option value="">Любой</option>
                <option value="W" {% if selected_season == 'W' %}selected{% endif %}>Зима</option>
                <option value="S" {% if selected_season == 'S' %}selected{% endif %}>Лето</option>
                <option value="D" {% if selected_season == 'D' %}selected{% endif %}>Демисезон</option>
                <option value="A" {% if selected_season == 'A' %}selected{% endif %}>Всесезон</option>
            </select>
        </label>

        <label>Размер: <input type="number" step="0.5" name="size" value="{{ selected_size }}"></label>

        <label>Категория:
            <select name="category">
                <option value="">Все</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if selected_category == cat.id|stringformat:"i" %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
        </label>

        <label>Бренд:
            <select name="brand">
                <option value="">Все</option>
                {% for brand in brands %}
                    <option value="{{ brand.id }}" {% if selected_brand == brand.id|stringformat:"i" %}selected{% endif %}>
                        {{ brand.name }}
                    </option>
                {% endfor %}
            </select>
        </label>

        <button type="submit">Применить</button>
    </form>
</div>

{% if shoes %}
    {% for shoe in shoes %}
    <div class="shoe-card">
        <h3>{{ shoe.name }} ({{ shoe.brand.name }})</h3>
        <p><strong>Цена:</strong> {{ shoe.price }} ₽</p>
        <p><strong>Категория:</strong> {{ shoe.category.name }}</p>
        <p><strong>Сезон:</strong> 
            {% if shoe.season == 'W' %}Зима
            {% elif shoe.season == 'S' %}Лето
            {% elif shoe.season == 'D' %}Демисезон
            {% else %}Всесезон{% endif %}
        </p>
        <p><strong>Материал верха:</strong> {{ shoe.material_upper }}</p>
        {% if shoe.heel_height_cm %}
            <p>Высота каблука: {{ shoe.heel_height_cm }} см</p>
        {% endif %}
        <div class="sizes">
            Доступные размеры: 
            {% for sz in shoe.sizes.all %}
                {% if sz.stock > 0 %}
                    {{ sz.size }} (в наличии: {{ sz.stock }})
                {% endif %}
            {% endfor %}
        </div>
        <a href="{% url 'shop:shoe_detail' shoe.pk %}">Подробнее →</a>
    </div>
    {% endfor %}
{% else %}
    <p>Обувь не найдена.</p>
{% endif %}
{% endblock %}